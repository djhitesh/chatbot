<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Broadband AI Assistant - Powered by Gemini</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            height: 90vh;
            max-height: 700px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 300;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #f8f9fa;
        }

        .message {
            display: flex;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 15px;
            line-height: 1.5;
            word-wrap: break-word;
            font-size: 14px;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 3px;
        }

        .message.bot .message-content {
            background: #e5e7eb;
            color: #333;
            border-bottom-left-radius: 3px;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.bot .message-avatar {
            background: #dbeafe;
            color: #667eea;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.5;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-10px);
            }
        }

        .input-section {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            background: white;
            display: flex;
            gap: 10px;
        }

        .input-group {
            flex: 1;
            display: flex;
            gap: 10px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 25px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            white-space: nowrap;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .settings-btn {
            padding: 10px 15px;
            font-size: 18px;
            background: #f3f4f6;
            color: #667eea;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-buttons button {
            padding: 10px 20px;
            font-size: 14px;
        }

        .cancel-btn {
            background: #e5e7eb !important;
            color: #333 !important;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            text-align: center;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px 16px;
            border-radius: 10px;
            border-left: 4px solid #dc2626;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            .container {
                max-height: 100vh;
                border-radius: 10px;
            }

            .message-content {
                max-width: 85%;
            }

            .header h1 {
                font-size: 18px;
            }

            .settings-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span class="status-indicator"></span>
                BroadbandAI Assistant
            </h1>
            <p>Your intelligent broadband support companion</p>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="empty-state">
                <div class="empty-state-icon">üåê</div>
                <div>Welcome to BroadbandAI Assistant!</div>
                <div style="font-size: 12px; margin-top: 10px; opacity: 0.7;">
                    Ask me anything about internet plans, speeds, installation, or connectivity
                </div>
            </div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <input 
                    type="text" 
                    id="messageInput" 
                    placeholder="Ask about broadband plans, speeds, connectivity..." 
                    autocomplete="off"
                >
                <button id="sendBtn" onclick="sendMessage()">Send</button>
            </div>
            <button class="settings-btn" onclick="openSettings()" title="Settings">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <h2>API Configuration</h2>
            <div class="form-group">
                <label for="apiKey">Gemini API Key</label>
                <input 
                    type="text" 
                    id="apiKey" 
                    placeholder="Enter your Gemini API key"
                    value=""
                >
                <div style="font-size: 12px; color: #666; margin-top: 8px;">
                    Get your free API key at <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #667eea;">aistudio.google.com</a>
                </div>
            </div>
            <div class="form-group">
                <label for="systemPrompt">System Prompt (optional)</label>
                <input 
                    type="text" 
                    id="systemPrompt" 
                    placeholder="Customize the assistant behavior"
                    value="You are a helpful broadband customer service expert. Assist customers with questions about internet plans, broadband speeds, WiFi connectivity, installation, billing, technical troubleshooting, network coverage, and account management. Be professional, friendly, and provide clear solutions."
                >
            </div>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeSettings()">Cancel</button>
                <button onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const settingsModal = document.getElementById('settingsModal');
        const apiKeyInput = document.getElementById('apiKey');
        const systemPromptInput = document.getElementById('systemPrompt');

        let API_KEY = localStorage.getItem('geminiApiKey') || '';
        let SYSTEM_PROMPT = localStorage.getItem('systemPrompt') || 'You are a helpful broadband customer service expert. Assist customers with questions about internet plans, broadband speeds, WiFi connectivity, installation, billing, technical troubleshooting, network coverage, and account management. Be professional, friendly, and provide clear solutions.';
        let conversationHistory = [];

        // Initialize
        window.addEventListener('load', () => {
            apiKeyInput.value = API_KEY;
            systemPromptInput.value = SYSTEM_PROMPT;
            loadChatHistory();
            messageInput.focus();
        });

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        async function sendMessage() {
            const message = messageInput.value.trim();
            
            if (!message) return;
            if (!API_KEY) {
                showError('Please configure your Gemini API key in settings first.');
                openSettings();
                return;
            }

            // Add user message to UI
            addMessageToChat('user', message);
            messageInput.value = '';
            sendBtn.disabled = true;

            // Add to conversation history
            conversationHistory.push({
                role: 'user',
                content: message
            });

            // Show typing indicator
            const typingId = showTypingIndicator();

            try {
                const response = await callGeminiAPI(message);
                removeTypingIndicator(typingId);
                addMessageToChat('bot', response);
                conversationHistory.push({
                    role: 'assistant',
                    content: response
                });
                saveChatHistory();
            } catch (error) {
                removeTypingIndicator(typingId);
                showError(`Error: ${error.message}`);
                console.error(error);
            } finally {
                sendBtn.disabled = false;
                messageInput.focus();
            }
        }

        async function callGeminiAPI(userMessage) {
            const endpoint = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent';
            
            const requestBody = {
                contents: [
                    {
                        role: 'user',
                        parts: [
                            {
                                text: `${SYSTEM_PROMPT}\n\nUser: ${userMessage}`
                            }
                        ]
                    }
                ],
                generationConfig: {
                    temperature: 0.7,
                    topK: 40,
                    topP: 0.95,
                    maxOutputTokens: 1024,
                }
            };

            const response = await fetch(`${endpoint}?key=${API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || `API Error: ${response.status}`);
            }

            const data = await response.json();
            
            if (!data.candidates || !data.candidates[0]?.content?.parts?.length) {
                throw new Error('Invalid response from API');
            }

            return data.candidates[0].content.parts[0].text;
        }

        function addMessageToChat(role, content) {
            if (document.querySelector('.empty-state')) {
                chatContainer.innerHTML = '';
            }

            const messageEl = document.createElement('div');
            messageEl.className = `message ${role}`;

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = role === 'user' ? 'üë§' : 'ü§ñ';

            const contentEl = document.createElement('div');
            contentEl.className = 'message-content';
            contentEl.textContent = content;

            if (role === 'user') {
                messageEl.appendChild(contentEl);
                messageEl.appendChild(avatar);
            } else {
                messageEl.appendChild(avatar);
                messageEl.appendChild(contentEl);
            }

            chatContainer.appendChild(messageEl);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const messageEl = document.createElement('div');
            messageEl.className = 'message bot';
            messageEl.id = `typing-${Date.now()}`;

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'ü§ñ';

            const contentEl = document.createElement('div');
            contentEl.className = 'typing-indicator';
            contentEl.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';

            messageEl.appendChild(avatar);
            messageEl.appendChild(contentEl);

            chatContainer.appendChild(messageEl);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            return messageEl.id;
        }

        function removeTypingIndicator(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        function showError(message) {
            const errorEl = document.createElement('div');
            errorEl.className = 'error-message';
            errorEl.textContent = message;
            chatContainer.appendChild(errorEl);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            setTimeout(() => errorEl.remove(), 5000);
        }

        function openSettings() {
            settingsModal.classList.add('active');
        }

        function closeSettings() {
            settingsModal.classList.remove('active');
        }

        function saveSettings() {
            const newApiKey = apiKeyInput.value.trim();
            const newPrompt = systemPromptInput.value.trim();

            if (!newApiKey) {
                alert('API key is required');
                return;
            }

            API_KEY = newApiKey;
            SYSTEM_PROMPT = newPrompt;

            localStorage.setItem('geminiApiKey', API_KEY);
            localStorage.setItem('systemPrompt', SYSTEM_PROMPT);

            closeSettings();
            alert('Settings saved successfully!');
        }

        function saveChatHistory() {
            localStorage.setItem('chatHistory', JSON.stringify(conversationHistory));
        }

        function loadChatHistory() {
            const saved = localStorage.getItem('chatHistory');
            if (saved) {
                conversationHistory = JSON.parse(saved);
                // Reload messages in UI
                chatContainer.innerHTML = '';
                conversationHistory.forEach(msg => {
                    addMessageToChat(msg.role === 'user' ? 'user' : 'bot', msg.content);
                });
            }
        }

        // Close modal when clicking outside
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) {
                closeSettings();
            }
        });
    </script>
</body>
</html>